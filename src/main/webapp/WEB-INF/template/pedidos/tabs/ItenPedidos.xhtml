<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:o="http://omnifaces.org/ui">

    <div style="margin-bottom: 10px; width: 100%">
            <p:autoComplete id="complete"
                    dropdown="true" maxResults="5" scrollHeight="250"
                    value="#{cadastroPedidoController.itemPedido.produto}"
                    var="produto" itemLabel="#{produto.nome}" itemValue="#{produto}"
                    completeMethod="#{cadastroPedidoController.pesquisarItenPedido}"
                    forceSelection="true" inputStyle="width: 90%" style="width: 90%"
                    placeholder="Pesquisar Produto">

                <p:ajax event="itemSelect" update="formGeral itemPedidos complete itemPedidos:qtd formGeral:total itemPedidos:totalFooter" listener="#{cadastroPedidoController.getCarregarProduto()}"/>


        </p:autoComplete>
    </div>
    <p:dataTable value="#{cadastroPedidoController.produtosGuardados}"
                emptyMessage="Nenhum produto selecionado." var="pedido" id="itemPedidos">
   

        <p:column headerText="Ação" style="width: 4%">
            <p:commandButton icon="pi pi-trash" title="Remover" update="formGeral"
                             action="#{cadastroPedidoController.removerProduto}" style="width: 100%">
            <f:setPropertyActionListener value="#{pedido}"  target="#{cadastroPedidoController.produtoSelecionado}"/>

            </p:commandButton>
        </p:column>

        <p:column headerText="SKU" style="text-align: left; width:10%">
            <p:inputText disabled="true" value="#{pedido.produto.sku}"
                         style="text-align: left; width:100%"/>
        </p:column>

        <p:column headerText="Produto">
            <p:inputText disabled="true" value="#{pedido.produto.nome}"
                         style="text-align: left; width:100%"/>
        </p:column>

        <p:column headerText="Valor Unitário" style="text-align: left; width:10%">
            <p:inputText disabled="true" value="#{pedido.produto.valorUnitario}"
                         style="text-align: left; width:100%">
                <f:convertNumber type="currency"/>
            </p:inputText>
        </p:column>

        <p:column headerText="Quantidade" id="qtd" style="text-align: left; width:10%">
            <p:inputText  value="#{pedido.qtd}" style="text-align: left; width:100%">
                <p:ajax event="change" process="@this"  update="formGeral" listener="#{cadastroPedidoController.recalcular()}"/>
            </p:inputText>
        </p:column>

        <p:column headerText="Estoque" style="text-align: left; width:10%">
            <p:inputText disabled="true" value="#{pedido.produto.estoque}"
                         style="text-align: left; width:100%"/>
        </p:column>

        <p:column headerText="Valor Total" id="valorTotal" style="text-align: left; width:10%">
            <p:inputText disabled="true"  value="#{pedido.valorTotal}"
                         style="text-align: left; width:100%">
                <f:convertNumber type="currency"/>
            </p:inputText>
        </p:column>

        <p:columnGroup type="footer">
            <p:row>
                <p:column colspan="6" footerText="Subtotal" style="text-align: right;"/>
                <p:column  style="text-align: right">
                    <f:facet name="footer">
                        <h:outputText id="totalFooter" value="#{cadastroPedidoController.pedido.total}">
                           <f:convertNumber type="currency"/>
                        </h:outputText>
                    </f:facet>
                </p:column>

            </p:row>
        </p:columnGroup>

    </p:dataTable>


</ui:composition>